<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>cinsk's yard</title>


    <!-- Le styles -->
    <link href="http://cinsk.github.io/css/bootstrap.css" rel="stylesheet"/>
    <link href="http://cinsk.github.io/css/bootstrap-responsive.css"
          rel="stylesheet"/>
    <link href="http://cinsk.github.io/css/docs.css" rel="stylesheet"/>
    <link href="http://cinsk.github.io/prettify.css" rel="stylesheet"/>
    <link href="../../../css/articles.css" rel="stylesheet"/>

    <link rel="alternate" type="application/rss+xml" title="RSS"
          href="/feed.xml">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="http://cinsk.github.io/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
          href="http://cinsk.github.io/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
          href="http://cinsk.github.io/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed"
          href="http://cinsk.github.io/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="http://cinsk.github.io/ico/favicon.png"/>

    <link href="/css/org.css" rel="stylesheet"/>
    <link href="/css/articles.css" rel="stylesheet"/>

    <script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
      <!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
    </script>
  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">
    <!-- Navbar
    ================================================== -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="./index.html">cinsk.org</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <!-- toplink: invalid parameter, label() not found -->

              <!--
              id: home<br/>
              label: Home<br/>
              locale: <br/>
              url: ../../../home/cinsk/www/www/index.html<br/>
              self: false<br/>
              -->
              
              <li class="active"><a href="../../../home/cinsk/www/www/index.html">Home</a></li>
              
              
              <!--
              id: cfaq<br/>
              label: C FAQ<br/>
              locale: <br/>
              url: ../../../home/cinsk/www/www/cfaqs/index.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="../../../home/cinsk/www/www/cfaqs/index.html">C FAQ</a></li>
              
              
              <!--
              id: article<br/>
              label: Articles<br/>
              locale: <br/>
              url: ../../../home/cinsk/www/www/articles.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="../../../home/cinsk/www/www/articles.html">Articles</a></li>
              
              
              <!--
              id: emacs<br/>
              label: Emacs<br/>
              locale: <br/>
              url: ../../../home/cinsk/www/www/emacs/index.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="../../../home/cinsk/www/www/emacs/index.html">Emacs</a></li>
              
              
              <!--
              id: resume<br/>
              label: Résumé<br/>
              locale: <br/>
              url: ../../../home/cinsk/www/www/resume.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="../../../home/cinsk/www/www/resume.html">Résumé</a></li>
              
              

              <!--
              
                -->
            </ul>
          </div>
        </div>
      </div>
    </div>

<!-- Subhead
================================================== -->
<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>cinsk's yard</h1>
    <!-- <p class="lead">A dirty macro that convert the scala type to string type in binary representation</p> -->
  </div>
</header>

  <div class="container">

    <div class="row">
      <div class="span10"></div>
      <div class="span2">
        <!-- This div should be floating and should not scroll,
             but I don't know anything about CSS, *sigh* -- cinsk -->
        <section id="lang">
          <-- DEBUG: url[en]:  --><-- DEBUG: url[ko]:  -->
        </section>
      </div>
    </div>

    <div class="row">
      <header>
  <h2 class='article-title'>A dirty macro that convert the scala type to string type in binary representation</h2>
</header>
<aside class='article-meta'>
  <ul class='unstyled'>
    <li class="date"><strong>26 Sep 2013</strong></li>
    <li class="tags">bin, binary, print, representation, and string</li>
  </ul>
</aside>
<p>Handy function that convert the scala type to string type in C.
<span id="continue"></span></p>


<p>
This is a not-portable GCC macro to produce binary-represented string
in C or C++.
</p>

<p>
Sometimes, it is useful to have a way to print a scala value in a binary
representation.  Unfortunately, there is no such format specifier for
<code>printf(3)</code>.  Luckily, <i>glibc</i> has a customization feature for <code>printf(3)</code>-like
functions.  If you're interested in, read the code <a href="https://github.com/cinsk/snippets/blob/master/printfb.c">here</a>.  For example,
you could write:
</p>

<div class="org-src-container">

<pre class="src src-c"><span class="org-type">int</span> <span class="org-variable-name">i</span> = 0xdeadbeef;
printf(<span class="org-string">"%b\n"</span>, i);      <span class="org-comment-delimiter">/* </span><span class="org-comment">print 11011110101011011011111011101111 </span><span class="org-comment-delimiter">*/</span>
</pre>
</div>

<p>
If you're not using <i>glibc</i>, you could create some utility functions to
do this.  Here're some candidate function prototypes:
</p>

<div class="org-src-container">

<pre class="src src-c"><span class="org-comment-delimiter">/* </span><span class="org-comment">return the binary represented string of VALUE.  The width</span>
<span class="org-comment"> * of the string is CHAR_BIT * size.  The return value should</span>
<span class="org-comment"> * be free(3)ed after use. </span><span class="org-comment-delimiter">*/</span>
<span class="org-type">char</span> *<span class="org-function-name">binstr</span>(<span class="org-type">unsigned</span> <span class="org-type">long</span> <span class="org-type">long</span> <span class="org-variable-name">value</span>, <span class="org-type">size_t</span> <span class="org-variable-name">size</span>);

<span class="org-comment-delimiter">/* </span><span class="org-comment">store the binary representation of VALUE in string pointed by BUF</span>
<span class="org-comment"> * with the size SIZE.  </span><span class="org-comment-delimiter">*/</span>
<span class="org-type">char</span> *<span class="org-function-name">binstr</span>(<span class="org-type">unsigned</span> <span class="org-type">long</span> <span class="org-type">long</span> <span class="org-variable-name">value</span>, <span class="org-type">char</span> *<span class="org-variable-name">buf</span>, <span class="org-type">size_t</span> <span class="org-variable-name">size</span>);
</pre>
</div>

<p>
I'm not satisfied with these.  The first one, which returns a value
that is dynamically allocated, looks heavy.  Plus, the caller should
supply the number of binary digit, since it always accept the value as
<code>unsigned long long</code>.  The second one, which works only when the user
provided the buffer as in the second and the third parameters.  It
does not look heavy, but probably someone may be not happy with it,
since the user always need to prepare the buffer.
</p>

<p>
I couldn't come up with a <i>everybody-satisified</i> solution with this.
</p>

<p>
Since most of my works are done in Linux and MacOS; both provides GCC,
so I decided to drop the portability. :)  
</p>

<div class="org-src-container">

<pre class="src src-c"><span class="org-preprocessor">#define</span> <span class="org-function-name">binstr</span>(<span class="org-variable-name">x</span>)       ({ <span class="org-type">char</span> *<span class="org-variable-name">p</span> = alloca(<span class="org-keyword">sizeof</span>(x) * CHAR_BIT + 1);  \
      <span class="org-type">char</span> *<span class="org-variable-name">q</span> = p + <span class="org-keyword">sizeof</span>(x) * CHAR_BIT;                               \
      *q-- = <span class="org-string">'\0'</span>;                                                      \
      <span class="org-type">int</span> <span class="org-variable-name">i</span>;                                                            \
      typeof(x) tmp = (x);                                              \
      <span class="org-keyword">for</span> (i = 0; i &lt; <span class="org-keyword">sizeof</span>(x) * CHAR_BIT; i++) {                      \
        *q-- = (tmp &amp; 1) ? <span class="org-string">'1'</span> : <span class="org-string">'0'</span>;                                   \
        tmp &gt;&gt;= 1;                                                      \
      }                                                                 \
      q + 1;                                                            \
    })
</pre>
</div>

<ul class="org-ul">
<li>I'm using <code>alloca(3)</code>, instead of <code>malloc(3)</code>, so that the memory
buffer should be freed automatically.  The caller no longer need to
call <code>free(3)</code>.</li>
<li>To decide the right number of digits of the value type, binstr is a
macro function.</li>
<li>I used <i>statement expression</i>, ({&#x2026;}) (GCC extension), which allows
me to declare local variables.</li>
<li>I used <i>typeof</i> operator (GCC extension), which allows to declare a
local variable, that has the same type as the parameter.</li>
</ul>


      <hr/>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'cinsk'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>

    <!-- Footer
    ================================================== -->
    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2013  Seong-Kook Shin;  All rights reserved except, </p>
        <p>CSS design, layouts are reserved to <a href="https://github.com/twitter/bootstrap/">bootstrap</a>,</p>
        <p>Icons and symbols are reserved to <a href="http://glyphicons.com">Glyphicons</a></p>
        <!--
        <p>Designed and built with all the love in the world by <a href="http://twitter.com/mdo" target="_blank">@mdo</a> and <a href="http://twitter.com/fat" target="_blank">@fat</a>.</p>
        <p>Code licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>, documentation under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
        <p><a href="http://glyphicons.com">Glyphicons Free</a> licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
        <ul class="footer-links">
          <li><a href="http://blog.getbootstrap.com">Blog</a></li>
          <li class="muted">&middot;</li>
          <li><a href="https://github.com/twitter/bootstrap/issues?state=open">Issues</a></li>
          <li class="muted">&middot;</li>
          <li><a href="https://github.com/twitter/bootstrap/wiki">Roadmap and changelog</a></li>
        </ul>
        -->
      </div>
    </footer>



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script type="text/javascript"
            src="http://platform.twitter.com/widgets.js"></script>

    <script src="http://www.cinsk.org/bootstrap/js/jquery.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-transition.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-alert.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-modal.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-dropdown.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-scrollspy.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-tab.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-tooltip.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-popover.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-button.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-collapse.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-carousel.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-typeahead.js"></script>
    <script src="http://cinsk.github.io/js/bootstrap-affix.js"></script>

    <script src="http://cinsk.github.io/js/holder/holder.js"></script>
    <script src="http://cinsk.github.io/prettify.js"></script>

    <script src="http://cinsk.github.io/js/application.js"></script>

  </body>
</html>
