<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>cinsk's yard</title>


    <!-- Le styles -->
    <link href="http://cinsk.github.io/bootstrap/css/bootstrap.css" rel="stylesheet"/>
    <link href="http://cinsk.github.io/bootstrap/css/bootstrap-responsive.css"
          rel="stylesheet"/>
    <link href="http://cinsk.github.io/bootstrap/css/docs.css" rel="stylesheet"/>
    <link href="http://cinsk.github.io/bootstrap/prettify.css" rel="stylesheet"/>
    <link href="../../../css/articles.css" rel="stylesheet"/>

    <link rel="alternate" type="application/rss+xml" title="RSS"
          href="/feed.xml">

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144"
          href="http://cinsk.github.io/bootstrap/ico/apple-touch-icon-144-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="114x114"
          href="http://cinsk.github.io/bootstrap/ico/apple-touch-icon-114-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed" sizes="72x72"
          href="http://cinsk.github.io/bootstrap/ico/apple-touch-icon-72-precomposed.png"/>
    <link rel="apple-touch-icon-precomposed"
          href="http://cinsk.github.io/bootstrap/ico/apple-touch-icon-57-precomposed.png"/>
    <link rel="shortcut icon" href="http://cinsk.github.io/bootstrap/ico/favicon.png"/>

    <link href="/css/org.css" rel="stylesheet"/>
    <link href="/css/articles.css" rel="stylesheet"/>

    <script type="text/javascript" src="http://orgmode.org/mathjax/MathJax.js">
      <!--/*--><![CDATA[/*><!--*/
    MathJax.Hub.Config({
        // Only one of the two following lines, depending on user settings
        // First allows browser-native MathML display, second forces HTML/CSS
        //  config: ["MMLorHTML.js"], jax: ["input/TeX"],
            jax: ["input/TeX", "output/HTML-CSS"],
        extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js",
                     "TeX/noUndefined.js"],
        tex2jax: {
            inlineMath: [ ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"], ["\\begin{displaymath}","\\end{displaymath}"] ],
            skipTags: ["script","noscript","style","textarea","pre","code"],
            ignoreClass: "tex2jax_ignore",
            processEscapes: false,
            processEnvironments: true,
            preview: "TeX"
        },
        showProcessingMessages: true,
        displayAlign: "center",
        displayIndent: "2em",

        "HTML-CSS": {
             scale: 100,
             availableFonts: ["STIX","TeX"],
             preferredFont: "TeX",
             webFont: "TeX",
             imageFont: "TeX",
             showMathMenu: true,
        },
        MMLorHTML: {
             prefer: {
                 MSIE:    "MML",
                 Firefox: "MML",
                 Opera:   "HTML",
                 other:   "HTML"
             }
        }
    });
/*]]>*///-->
    </script>
  </head>

  <body data-spy="scroll" data-target=".bs-docs-sidebar">
    <!-- Navbar
    ================================================== -->
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" href="./index.html">cinsk.org</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <!-- toplink: invalid parameter, label() not found -->

              <!--
              id: home<br/>
              label: Home<br/>
              locale: <br/>
              url: /index.html<br/>
              self: false<br/>
              -->
              
              <li class="active"><a href="/index.html">Home</a></li>
              
              
              <!--
              id: cfaq<br/>
              label: C FAQ<br/>
              locale: <br/>
              url: /cfaqs/index.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="/cfaqs/index.html">C FAQ</a></li>
              
              
              <!--
              id: article<br/>
              label: Articles<br/>
              locale: <br/>
              url: /articles.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="/articles.html">Articles</a></li>
              
              
              <!--
              id: emacs<br/>
              label: Emacs<br/>
              locale: <br/>
              url: /emacs/index.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="/emacs/index.html">Emacs</a></li>
              
              
              <!--
              id: resume<br/>
              label: Résumé<br/>
              locale: <br/>
              url: /resume.html<br/>
              self: false<br/>
              -->
              
              <li class=""><a href="/resume.html">Résumé</a></li>
              
              

              <!--
              
                -->
            </ul>
          </div>
        </div>
      </div>
    </div>

<!-- Subhead
================================================== -->
<header class="jumbotron subhead" id="overview">
  <div class="container">
    <h1>cinsk's yard</h1>
    <!-- <p class="lead">Check stale NFS mount point</p> -->
  </div>
</header>

  <div class="container">

    <div class="row">
      <div class="span10"></div>
      <div class="span2">
        <!-- This div should be floating and should not scroll,
             but I don't know anything about CSS, *sigh* -- cinsk -->
        <section id="lang">
          <-- DEBUG: url[en]:  --><-- DEBUG: url[ko]:  -->
        </section>
      </div>
    </div>

    <div class="row">
      <div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. Check stale NFS</a></li>
</ul>
</div>
</div>
<header>
  <h2 class='article-title'>Check stale NFS mount point</h2>
</header>
<aside class='article-meta'>
  <ul class='unstyled'>
    <li class="date"><strong>02 Jul 2014</strong></li>
    <li class="tags">check, nfs, and stale</li>
  </ul>
</aside>
<p><span id="continue"></span></p>


<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Check stale NFS</h2>
<div class="outline-text-2" id="text-1">
<p>
Here's a simple script to check whether the given directory (NFS mount point)
is stale.
</p>

<script src="https://gist.github.com/cinsk/840ed553905cb6e8f0ae.js"></⁠script>

<p>
There are three points that needs some explanation here.
</p>

<p>
First, since any command that access the NFS file system would block
(unresponsive) iff the NFS is stale, I am using <code>read -t N</code> for the
timeout.
</p>

<p>
Second, I used process substitution feature of bash, <code>&lt;(list)</code> form.
Basically, <code>read -t 1 &lt; &lt;(...)</code> will timeout after 1 second unless
=⁠&#x2026;= part finished within the timeout.  <i>bash</i> will create a new
subshell to execute /⁠list/ in <code>&lt;(list)</code> form.  The problem is, if
any of <i>list</i> will access the stale NFS, the command will hang,
which makes the subshell also will hang.  Even if the calling shell
script finished, the subshell would not terminated, leaving the
process in <i>interruptible sleep</i> state.
</p>

<p>
To prevent this, I recorded the sub-shell PID using <code>$BASHPID</code> in
<code>&lt;(list)</code> form.  After =⁠read= command, I deleted all possible
children of the subshell and the subshell itself.  Note that using
<code>$$</code> won't work in <code>&lt;(list)</code> form.  =⁠$$= represents the mother
shell's PID, not the sub-shell's.
</p>
</div>


      <hr/>

      <div id="disqus_thread"></div>
      <script type="text/javascript">
/* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
var disqus_shortname = 'cinsk'; // required: replace example with your forum shortname

/* * * DON'T EDIT BELOW THIS LINE * * */
(function() {
  var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>

    <!-- Footer
    ================================================== -->
    <footer class="footer">
      <div class="container">
        <p>Copyright &copy; 2013  Seong-Kook Shin;  All rights reserved except, </p>
        <p>CSS design, layouts are reserved to <a href="https://github.com/twitter/bootstrap/">bootstrap</a>,</p>
        <p>Icons and symbols are reserved to <a href="http://glyphicons.com">Glyphicons</a></p>
        <!--
        <p>Designed and built with all the love in the world by <a href="http://twitter.com/mdo" target="_blank">@mdo</a> and <a href="http://twitter.com/fat" target="_blank">@fat</a>.</p>
        <p>Code licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0" target="_blank">Apache License v2.0</a>, documentation under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
        <p><a href="http://glyphicons.com">Glyphicons Free</a> licensed under <a href="http://creativecommons.org/licenses/by/3.0/">CC BY 3.0</a>.</p>
        <ul class="footer-links">
          <li><a href="http://blog.getbootstrap.com">Blog</a></li>
          <li class="muted">&middot;</li>
          <li><a href="https://github.com/twitter/bootstrap/issues?state=open">Issues</a></li>
          <li class="muted">&middot;</li>
          <li><a href="https://github.com/twitter/bootstrap/wiki">Roadmap and changelog</a></li>
        </ul>
        -->
      </div>
    </footer>



    <!-- Le javascript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->

    <script type="text/javascript"
            src="http://platform.twitter.com/widgets.js"></script>

    <script src="http://cinsk.github.io/bootstrap/js/jquery.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-transition.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-alert.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-modal.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-dropdown.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-scrollspy.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-tab.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-tooltip.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-popover.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-button.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-collapse.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-carousel.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-typeahead.js"></script>
    <script src="http://cinsk.github.io/bootstrap/js/bootstrap-affix.js"></script>

    <script src="http://cinsk.github.io/bootstrap/js/holder/holder.js"></script>
    <script src="http://cinsk.github.io/bootstrap/prettify.js"></script>

    <script src="http://cinsk.github.io/bootstrap/js/application.js"></script>

  </body>
</html>
